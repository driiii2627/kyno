module.exports=[3769,a=>{"use strict";var b=a.i(37936);a.i(42537);var c=a.i(5860),d=a.i(5246),e=a.i(13095);let f=["gmail.com","outlook.com","hotmail.com","live.com","yahoo.com","icloud.com","proton.me","protonmail.com"];async function g(a){let b=String(a.get("email")),e=String(a.get("password"));String(a.get("code"));let f=String(a.get("cf-turnstile-response")),g=(await (0,d.headers)()).get("x-forwarded-for")||"127.0.0.1",h=await (0,d.cookies)(),i=(0,c.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>h.getAll(),setAll(a){try{a.forEach(({name:a,value:b,options:c})=>h.set(a,b,c))}catch{}}}}),{data:j,error:k}=await i.rpc("check_and_update_rate_limit",{request_ip:g,request_email:b,request_type:"login",max_attempts:4,block_duration_seconds:120});if(j&&!j.allowed)return{error:"Muitas tentativas falhas. Tente novamente mais tarde.",blockedUntil:j.blocked_until};let l=process.env.TURNSTILE_SECRET_KEY;if(!l)return{error:"Configuração de servidor inválida."};let m=await fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:l,response:f,remoteip:g})});if(!(await m.json()).success)return{error:"Falha na verificação de segurança (Captcha)."};let{error:n}=await i.auth.signInWithPassword({email:b,password:e});return n?(console.error("Login Error:",n.message),{error:n.message}):(await i.rpc("reset_rate_limit",{request_ip:g,request_type:"login"}),{success:!0})}async function h(b){let e,g=String(b.get("email")),h=String(b.get("password")),i=String(b.get("code")),j=String(b.get("cf-turnstile-response"));if(e=g.split("@")[1]?.toLowerCase(),!f.includes(e))return{error:"Domínio de e-mail não permitido. Use Gmail, Outlook, Yahoo, etc."};let k=(await (0,d.headers)()).get("x-forwarded-for")||"127.0.0.1",l=await (0,d.cookies)(),m=(0,c.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>l.getAll(),setAll(a){try{a.forEach(({name:a,value:b,options:c})=>l.set(a,b,c))}catch{}}}}),{data:n}=await m.rpc("check_and_update_rate_limit",{request_ip:k,request_email:g,request_type:"register",max_attempts:9,block_duration_seconds:120});if(n&&!n.allowed)return{error:"Muitas tentativas de cadastro. Aguarde um momento.",blockedUntil:n.blocked_until};let o=process.env.TURNSTILE_SECRET_KEY;if(!o)return{error:"Configuração de servidor inválida."};let p=await fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:o,response:j,remoteip:k})});if(!(await p.json()).success)return{error:"Falha na verificação de segurança (Captcha)."};let{data:q}=await m.rpc("check_ip_registration_rate_limit",{request_ip:k});if(!1===q)return{error:"Limite de contas atingido para este dispositivo."};let r={user:null,session:null},s=null,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(t){let{createClient:b}=await a.A(54178),c=b(process.env.NEXT_PUBLIC_SUPABASE_URL,t,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:d,error:e}=await c.auth.admin.createUser({email:g,password:h,email_confirm:!0});if(e)s=e;else if(d.user){r.user=d.user;let{data:a,error:b}=await m.auth.signInWithPassword({email:g,password:h});b?console.error("Auto-login failed after admin creation",b):r.session=a.session}}else{let{data:a,error:b}=await m.auth.signUp({email:g,password:h});r=a,s=b}return s?{error:s.message}:(r.user&&(await m.from("kyno_user_security_logs").insert({user_id:r.user.id,unique_login_code:i,registration_ip:k,last_ip:k}),await m.rpc("reset_rate_limit",{request_ip:k,request_type:"register"})),r.session)?{success:!0,autoLogin:!0}:{success:!0,autoLogin:!1}}(0,e.ensureServerEntryExports)([g,h]),(0,b.registerServerReference)(g,"400082d863ec6ec9b9313eab5cc4d39f428d8ee165",null),(0,b.registerServerReference)(h,"405f1d1ebcdca18c23098ba1f418289facfb43d571",null),a.s(["loginAction",()=>g,"registerAction",()=>h])},10618,a=>{"use strict";var b=a.i(79714),c=a.i(3769);a.s([],38931),a.i(38931),a.s(["00044a13b912e98127fb87132cc89613aabacf9b57",()=>b.signOutAction,"0018c6db43529b3ca9c55f1a4bb647fb8415811d1d",()=>b.getProfilesAction,"0056cb79b9ec21b37d317dc696b43a5f5c326ae982",()=>b.getActiveProfileAction,"400082d863ec6ec9b9313eab5cc4d39f428d8ee165",()=>c.loginAction,"4009cb87dbf8261408287db81f95ca338a80372201",()=>b.switchProfileAction,"405f1d1ebcdca18c23098ba1f418289facfb43d571",()=>c.registerAction,"407fa483aadb683ffaf8d267be44a2d4010bfbd905",()=>b.createProfileAction,"40c7e6cc5ffa74f4aaa5de5b158ce112ad5e6af404",()=>b.updateProfileAction,"40fc0c27050575de9cc323afb67bce1d8322753d08",()=>b.deleteProfileAction],10618)},54178,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_@supabase_supabase-js_dist_index_mjs_49b0c50b._.js"].map(b=>a.l(b))).then(()=>b(60527)))}];

//# sourceMappingURL=_c208aa10._.js.map